from transformers import GPT2Model, GPT2Tokenizer
import torch
from src.trl.gpt2 import GPT2HeadWithValueModel
from transformers import pipeline
from src.reward_model import AMRGraphRewardModel


def main():
    # classifier = pipeline("text-classification", model="jy46604790/Fake-News-Bert-Detect", return_all_scores=True)
    # examples = ["Yesterday, Speaker Paul Ryan tweeted a video of himself on the Mexican border flying in a helicopter and traveling on horseback with US border agents. RT if you agree  It is time for The Wall. pic.twitter.com/s5MO8SG7SL  Paul Ryan (@SpeakerRyan) August 1, 2017It makes for great theater to see Republican Speaker Ryan pleading the case for a border wall, but how sincere are the GOP about building the border wall? Even after posting a video that appears to show Ryan s support for the wall, he still seems unsure of himself. It s almost as though he s testing the political winds when he asks Twitter users to retweet if they agree that we need to start building the wall. How committed is the (formerly?) anti-Trump Paul Ryan to building the border wall that would fulfill one of President Trump s most popular campaign promises to the American people? Does he have the what it takes to defy the wishes of corporate donors and the US Chamber of Commerce, and do the right thing for the national security and well-being of our nation?The Last Refuge- Republicans are in control of the House of Representatives, Republicans are in control of the Senate, a Republican President is in the White House, and somehow there s  negotiations  on how to fund the #1 campaign promise of President Donald Trump, the border wall.Here s the rub.Here s what pundits never discuss.The Republican party doesn t need a single Democrat to fund the border wall.A single spending bill could come from the House of Representatives that fully funds 100% of the border wall. The spending bill then goes to the senate, where again, it doesn t need a single Democrat vote because spending legislation is specifically what  reconciliation  was designed to facilitate. That House bill can pass the Senate with 51 votes and proceed directly to the President s desk for signature.So, ask yourself: why is this even a point of discussion?The honest answer, for those who are no longer suffering from Battered Conservative Syndrome, is that Republicans don t want to fund or build an actual physical barrier known as the Southern Border Wall.It really is that simple.If one didn t know better, they d almost think Speaker Ryan was attempting to emulate the man he clearly despised during the 2016 presidential campaign."]
    # output = classifier(examples)
    # print(output)
    rw = AMRGraphRewardModel("/home/salvatori/transformer_rl/spring/AMR3.parsing.pt")
    rewards = rw.get_reward(
        [
            """Background Paediatric flat feet are a common presentation in primary care; reported prevalence approximates 15%. A minority of flat feet can hurt and limit gait. There is no optimal strategy, nor consensus, for using foot orthoses (FOs) to treat paediatric flat feet. Objectives To assess the benefits and harms of foot orthoses for treating paediatric flat feet. Search methods We searched CENTRAL, MEDLINE, and Embase to 01 September 2021, and two clinical trials registers on 07 August 2020. Selection criteria We identified all randomised controlled trials (RCTs) of FOs as an intervention for paediatric flat feet. The outcomes included in this review were pain, function, quality of life, treatment success, and adverse events. Intended comparisons were: any FOs versus sham, any FOs versus shoes, customised FOs (CFOs) versus prefabricated FOs (PFOs). Data collection and analysis We followed standard methods recommended by Cochrane. Main results We included 16 trials with 1058 children, aged 11 months to 19 years, with flexible flat feet. Distinct flat foot presentations included asymptomatic, juvenile idiopathic arthritis (JIA), symptomatic and developmental co‐ordination disorder (DCD). The trial interventions were FOs, footwear, foot and rehabilitative exercises, and neuromuscular electrical stimulation (NMES). Due to heterogeneity, we did not pool the data. Most trials had potential for selection, performance, detection, and selective reporting bias. No trial blinded participants. We present the results separately for asymptomatic (healthy children) and symptomatic (children with JIA) flat feet. The certainty of evidence was very low to low, downgraded for bias, imprecision, and indirectness. Three comparisons were evaluated across trials: CFO versus shoes; PFO versus shoes; CFO versus PFO. Asymptomatic flat feet 1.  CFOs versus shoes  (1 trial, 106 participants): low‐quality evidence showed that CFOs result in little or no difference in the proportion without pain (10‐point visual analogue scale (VAS)) at one year (risk ratio (RR) 0.85, 95% confidence interval (CI) 0.67 to 1.07); absolute decrease (11.8%, 95% CI 4.7% fewer to 15.8% more); or on withdrawals due to adverse events (RR 1.05, 95% CI 0.94 to 1.19); absolute effect (3.4% more, 95% CI 4.1% fewer to 13.1% more). 2.  PFOs versus shoes  (1 trial, 106 participants): low to very‐low quality evidence showed that PFOs result in little or no difference in the proportion without pain (10‐point VAS) at one year (RR 0.94, 95% CI 0.76 to 1.16); absolute effect (4.7% fewer, 95% CI 18.9% fewer to 12.6% more); or on withdrawals due to adverse events (RR 0.99, 95% CI 0.79 to 1.23). 3.  CFOs versus PFOs  (1 trial, 108 participants): low‐quality evidence found no difference in the proportion without pain at one year (RR 0.93, 95% CI 0.73 to 1.18); absolute effect (7.4% fewer, 95% CI 22.2% fewer to 11.1% more); or on withdrawal due to adverse events (RR 1.00, 95% CI 0.90 to 1.12). Function and quality of life (QoL) were not assessed. Symptomatic (JIA) flat feet 1.  CFOs versus shoes  (1 trial, 28 participants, 3‐month follow‐up): very low‐quality evidence showed little or no difference in pain (0 to 10 scale, 0 no pain) between groups (MD ‐1.5, 95% CI ‐2.78 to ‐0.22). Low‐quality evidence showed improvements in function with CFOs (Foot Function Index ‐ FFI disability, 0 to 100, 0 best function; MD ‐18.55, 95% CI ‐34.42 to ‐2.68), child‐rated QoL (PedsQL, 0 to 100, 100 best quality; MD 12.1, 95% CI ‐1.6 to 25.8) and parent‐rated QoL (PedsQL MD 9, 95% CI ‐4.1 to 22.1) and little or no difference between groups in treatment success (timed walking; MD ‐1.33 seconds, 95% CI ‐2.77 to 0.11), or withdrawals due to adverse events (RR 0.58, 95% CI 0.11 to 2.94); absolute difference (9.7% fewer, 20.5 % fewer to 44.8% more). 2.  PFOs versus shoes  (1 trial, 25 participants, 3‐month follow‐up): very low‐quality evidence showed little or no difference in pain between groups (MD 0.02, 95% CI ‐1.94 to 1.98). Low‐quality evidence showed no difference between groups in function (FFI‐disability MD ‐4.17, 95% CI ‐24.4 to 16.06), child‐rated QoL (PedsQL MD ‐3.84, 95% CI ‐19 to 11.33), or parent‐rated QoL (PedsQL MD ‐0.64, 95% CI ‐13.22 to 11.94). 3.  CFOs versus PFOs  (2 trials, 87 participants): low‐quality evidence showed little or no difference between groups in pain (0 to 10 scale, 0 no pain) at 3 months (MD ‐1.48, 95% CI ‐3.23 to 0.26), function (FFI‐disability MD ‐7.28, 95% CI ‐15.47 to 0.92), child‐rated QoL (PedsQL MD 8.6, 95% CI ‐3.9 to 21.2), or parent‐rated QoL (PedsQL MD 2.9, 95% CI ‐11 to 16.8). Authors' conclusions Low to very low‐certainty evidence shows that the effect of CFOs (high cost) or PFOs (low cost) versus shoes, and CFOs versus PFOs on pain, function and HRQoL is uncertain. This is pertinent for clinical practice, given the economic disparity between CFOs and PFOs. FOs may improve pain and function, versus shoes in children with JIA, with minimal delineation between costly CFOs and generic PFOs. This review updates that from 2010, confirming that in the absence of pain, the use of high‐cost CFOs for healthy children with flexible flat feet has no supporting evidence, and draws very limited conclusions about FOs for treating paediatric flat feet. The availability of normative and prospective foot development data, dismisses most flat foot concerns, and negates continued attention to this topic. Attention should be re‐directed to relevant paediatric foot conditions, which cause pain, limit function, or reduce quality of life. The agenda for researching asymptomatic flat feet in healthy children must be relegated to history, and replaced by a targeted research rationale, addressing children with indisputable foot pathology from discrete diagnoses, namely JIA, cerebral palsy, congenital talipes equino varus, trisomy 21 and Charcot Marie Tooth. Whether research resources should continue to be wasted on studying flat feet in healthy children that do not hurt, is questionable. Future updates of this review will address only relevant paediatric foot conditions."""
        ],
        [
            """Foot orthoses for treating flat feet in children Review question What are the benefits and harms of using foot orthoses (shoe inserts) to treat flat feet in children? Background Children with flat feet have a lower foot arch. When the child is standing, the foot arch looks flat against the floor, and may roll inwards, and even touch the floor. Sometimes, flat feet can cause pain, or change the way a child walks. There are many types of non‐surgical treatments for flat feet, but unless painful, most children do not need any treatment. Foot orthoses (FOs) or shoe inserts, muscle stretching, footwear selection, physical activity modification, and reducing body weight, may be part of an overall foot and activity management. The short‐term use of medication for pain and inflammation may be prescribed. Study characteristics This Cochrane Review is current to September 2021. There are 16 studies (1058 children, aged 11 months to 19 years) including three groups ‐ healthy children with painless flat feet; children with arthritis and painful flat feet; others (developmental coordination disorder; painful flat feet). The studies were conducted across the USA, Australia, India, Iran, Turkey, UK, and Republic of Korea. We found information about footwear, exercises, and different types of foot orthoses. Results: Comparing custom foot orthoses  ( CFOs) to shoes in painless flat feet: Proportion without pain (1 trial, 106 children) at 12 months: 12% fewer children with CFOs were without pain (ranging from 26% fewer to 5.5% more) 67 out of 100 children were without pain with CFOs compared to 79 children out of 100 with shoes. Withdrawal due to side effects (3 trials, 211 children): 3% more children with CFOs withdrew from treatment due to side effects (ranging from 4% fewer to 13% more) . 72 out of 100 children withdrew from treatment with CFOs compared with 69 children out of 100 with shoes. Comparing prefabricated foot orthoses (PFOs) to shoes in painless flat feet Proportion without pain (1 trial, 106 children) at 12 months: 5% fewer children with PFOs were without pain (ranging from 18.9% fewer to 12.6% more) 74 out of 100 children were without pain with PFOs compared to 79 out of 100 children with shoes. Withdrawal due to side effects (4 trials, 338 children): 0.7% fewer children with PFOs withdrew from treatment due to side effects (ranging from 15.2% fewer to 16.6% more). 71 out of 100 children withdrew from treatment with PFOs compared with 72 out of 100 children with shoes. Comparing CFOs to PFOs in painless flat feet Proportion without pain (1 trial, 106 children) at 12 months: 7% fewer children with CFOs were without pain (ranging from 22.2% fewer to 11.1% more) 68 out of 100 children were without pain with CFOs compared to 74 out of 100 children with PFOs. Withdrawal due to side effects (1 trial, 118 children): 0% fewer children withdrew from treatment with CFOs due to side effects (ranging from 9.2% fewer to 11% more). 91 out of 100 children withdrew from treatment with CFOs compared with 91 out of 100 children with PFOs. Function, quality of life, treatment success and side effects were not reported in these trials Quality of the evidence In healthy children with painless flat feet, low to very low‐quality evidence shows that compared to shoes, CFOs and PFOs result in no difference in the proportion without pain or withdrawal due to side effects from treatment. The quality of the evidence is very low to low, weakening conclusions. We downgraded the certainty of the evidence because the trials were poorly conducted and there were not enough data."""
        ],
    )
    print(rewards)


if __name__ == "__main__":
    main()
